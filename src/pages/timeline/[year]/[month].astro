---
import type { GetStaticPaths, InferGetStaticPropsType } from 'astro';

import { FEATURE_DATE_ARCHIVES } from '#constants.ts';
import TimelineMonthly from '#layouts/timeline-monthly.astro';
import { getTimelineDataMap } from '#lib/timeline/timeline-data.ts';

export const getStaticPaths = (async () => {
	if (!FEATURE_DATE_ARCHIVES) return [];

	const timelineItemsMap = await getTimelineDataMap();

	const years = [...timelineItemsMap.keys()].sort((a, b) => Number(b) - Number(a));

	const results = [];

	for (const [year, yearlyData] of timelineItemsMap.entries()) {
		for (const [month, monthlyData] of yearlyData.entries()) {
			results.push({
				params: { year, month },
				props: {
					monthlyData,
					month,
					year,
					years,
				},
			});
		}
	}
	return results;
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;
---

<TimelineMonthly {...Astro.props} />
