---
import type { GetStaticPaths, InferGetStaticPropsType } from 'astro';

import * as R from 'remeda';

import ResourcesIndex from '#layouts/resources-index.astro';
import { getResourcesCollection } from '#lib/collections/resources/resources-data.ts';
import { filterWithContent, sortByContentCount } from '#lib/utils/collections.ts';

export const getStaticPaths = (async ({ paginate }) => {
	const { resources } = await getResourcesCollection();

	const items = R.pipe(
		resources,
		R.filter((resource) => !!resource.data.showPage),
		R.filter(filterWithContent),
		R.sort(sortByContentCount),
	);

	return paginate(items, { pageSize: 50 });
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;
---

<ResourcesIndex {...Astro.props} />
