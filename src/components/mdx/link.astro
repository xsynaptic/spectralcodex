---
import type { HTMLAttributes } from 'astro/types';

import { getContentMetadataById } from '#lib/metadata/metadata-utils.ts';
import { renderSlot } from '#lib/utils/astro.ts';

interface Props extends HTMLAttributes<'a'> {
	id: string | undefined;
}

const { id, ...props } = Astro.props;

const content = await renderSlot(Astro.slots, 'default');

const pathname = Astro.url.pathname;

if (!id) {
	throw new Error(`Link component requires an ID; rendering path: ${pathname}`);
}

const contentMetadata = await getContentMetadataById(id);
---

{
	contentMetadata?.url ? (
		<a href={contentMetadata.url} {...props}>
			<Fragment set:html={content} />
		</a>
	) : (
		<Fragment set:html={content} />
	)
}
