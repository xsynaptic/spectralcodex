---
import type { ContentMetadataItem } from '#lib/metadata/metadata-types.ts';

import Link from '#components/parts/link.astro';
import TextMultilingual from '#components/parts/text-multilingual.astro';
import TextSeparated from '#components/parts/text-separated.astro';
import { getTranslations } from '#lib/i18n/i18n-translations.ts';
import { formatStringTemplate } from '#lib/utils/text.ts';

interface Props {
	items: Array<ContentMetadataItem>;
	count?: number | undefined;
	countThreshold?: number | undefined;
}

const { items, count, countThreshold = 10, ...props } = Astro.props;

const showCount = count ? Math.abs(items.length - count) > countThreshold : false;

const numberFormatter = Intl.NumberFormat('en', { maximumFractionDigits: 0 });

const t = getTranslations();

function getCountText() {
	if (showCount && count) {
		return {
			title: formatStringTemplate(t('parts.textSeparatedList.more'), {
				count: numberFormatter.format(count - items.length),
			}),
			url: undefined,
		};
	}
	return;
}

const countText = getCountText();
---

{
	countText
		? [...items, countText].map((item, index) => (
				<TextSeparated index={index} total={items.length + 1} {...props}>
					{item.url ? (
						<>
							<Link href={item.url}>{item.title}</Link>
							{item.titleMultilingual ? (
								<>
									{' '}
									<TextMultilingual content={item.titleMultilingual} parenthesis={true} />
								</>
							) : undefined}
						</>
					) : (
						item.title
					)}
				</TextSeparated>
			))
		: items.map((item, index) => (
				<TextSeparated index={index} total={items.length} {...props}>
					<Link href={item.url}>{item.title}</Link>
					{item.titleMultilingual ? (
						<>
							{' '}
							<TextMultilingual content={item.titleMultilingual} parenthesis={true} />
						</>
					) : undefined}
				</TextSeparated>
			))
}
