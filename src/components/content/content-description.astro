---
import type { CollectionEntry } from 'astro:content';

import { transformMarkdown } from '@xsynaptic/unified-tools';
import { render } from 'astro:content';

import ContentSection from '#components/content/content-section.astro';
import ProseBody from '#components/parts/prose-body.astro';
import ProseDescription from '#components/parts/prose-description.astro';
import { getRegionLangCodeByEntry } from '#lib/collections/regions/regions-utils.ts';
import { getHasContent } from '#lib/utils/astro.ts';

interface Props {
	class?: string | undefined;
	entry: CollectionEntry<'locations' | 'regions' | 'resources' | 'series' | 'themes'>;
}

const { class: className, entry, ...props } = Astro.props;

const langCode = await getRegionLangCodeByEntry(entry);

const wrapCjkOptions = langCode ? { langCode: langCode.startsWith('zh') ? 'zh' : langCode } : {};

const hasContent = getHasContent(entry);

const { Content } = await render(entry);
---

{
	hasContent ? (
		<ProseBody class:list={['content', 'pb-medium', className]} data-pagefind-weight="2" {...props}>
			<Content />
		</ProseBody>
	) : undefined
}{
	!hasContent && entry.data.description ? (
		<ContentSection {...props}>
			<Fragment slot="section-description">
				<ProseDescription class:list={[className]} data-pagefind-weight="2">
					<Fragment
						set:html={transformMarkdown({ input: entry.data.description, wrapCjkOptions })}
					/>
				</ProseDescription>
			</Fragment>
		</ContentSection>
	) : undefined
}
