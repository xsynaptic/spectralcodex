---
import type { CollectionEntry, CollectionKey } from 'astro:content';

import ContentSection from '#components/content/content-section.astro';
import Link from '#components/parts/link.astro';
import ListColumnItem from '#components/parts/list-column-item.astro';
import ListColumn from '#components/parts/list-column.astro';
import MetadataGrid from '#components/parts/metadata-grid.astro';
import TextMultilingual from '#components/parts/text-multilingual.astro';
import { getTranslations } from '#lib/i18n/i18n-translations.ts';
import { getRelatedContentFunction } from '#lib/utils/related.ts';

interface Props {
	entry: CollectionEntry<CollectionKey>;
	showPreviews?: boolean | undefined;
	limit?: number | undefined;
	threshold?: number;
}

const { entry, showPreviews, limit = 10, threshold = 0.5, ...props } = Astro.props;

const getRelatedContent = await getRelatedContentFunction();

const relatedContentItems = getRelatedContent({
	id: entry.id,
	limit,
	threshold,
});

const t = getTranslations();
---

{
	relatedContentItems.length > 0 ? (
		<ContentSection data-pagefind-ignore data-nosnippet {...props}>
			<Fragment slot="section-title">{t('content.section.related')}</Fragment>
			{showPreviews ? (
				<MetadataGrid
					items={relatedContentItems}
					showDate={true}
					showRegion={true}
					showTitleMultilingual={true}
				/>
			) : (
				<ListColumn class="font-serif text-xs sm:text-sm">
					{relatedContentItems.map(({ url, title, titleMultilingual }) => (
						<ListColumnItem>
							<Link href={url}>{title}</Link>
							{titleMultilingual ? (
								<TextMultilingual content={titleMultilingual} parenthesis={true} />
							) : undefined}
						</ListColumnItem>
					))}
				</ListColumn>
			)}
		</ContentSection>
	) : undefined
}
