---
import ContentSection from '#components/content/content-section.astro';
import DividedItem from '#components/parts/divided-item.astro';
import Link from '#components/parts/link.astro';
import ListRow from '#components/parts/list-row.astro';
import TextMultilingual from '#components/parts/text-multilingual.astro';
import { getThemesByIdsFunction } from '#lib/collections/themes/utils.ts';
import { getTranslations } from '#lib/i18n/i18n-translations.ts';
import { getPrimaryMultilingualContent } from '#lib/i18n/i18n-utils.ts';
import { sortByContentCount } from '#lib/utils/collections.ts';
import { MicroformatClassNames } from '#lib/utils/microformats.ts';
import { getContentUrl } from '#lib/utils/routing.ts';

interface Props {
	themeIds: Array<string> | undefined;
}

const { themeIds, ...props } = Astro.props;

const getThemesByIds = await getThemesByIdsFunction();

const themes = themeIds ? getThemesByIds(themeIds).sort(sortByContentCount) : undefined;

const t = getTranslations();
---

{
	themes && themes.length > 0 ? (
		<ContentSection data-pagefind-ignore data-nosnippet {...props}>
			<Fragment slot="section-title">{t('collection.themes.labelPlural')}</Fragment>
			<ListRow>
				{themes.map((item) => {
					const titleMultilingual = getPrimaryMultilingualContent(item.data, 'title');

					return (
						<DividedItem
							as="li"
							class:list={[
								'font-serif text-sm after:text-sm after:font-light',
								MicroformatClassNames.Category,
							]}
							data-pagefind-filter="theme"
						>
							{item.data.title ? (
								<Link href={getContentUrl(item.collection, item.id)}>{item.data.title}</Link>
							) : undefined}
							{titleMultilingual ? (
								<>
									{' '}
									<TextMultilingual content={titleMultilingual} parenthesis={true} />
								</>
							) : undefined}
						</DividedItem>
					);
				})}
			</ListRow>
		</ContentSection>
	) : undefined
}
