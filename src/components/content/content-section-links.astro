---
import type { CollectionEntry } from 'astro:content';

import ContentSection from '#components/content/content-section.astro';
import DividedItem from '#components/parts/divided-item.astro';
import Link from '#components/parts/link.astro';
import ListColumnItem from '#components/parts/list-column-item.astro';
import ListColumn from '#components/parts/list-column.astro';
import TextMultilingual from '#components/parts/text-multilingual.astro';
import { getResolveResourceLinksFunction } from '#lib/collections/resources/resources-utils.ts';
import { getTranslations } from '#lib/i18n/i18n-translations.ts';
import { getPrimaryMultilingualContent } from '#lib/i18n/i18n-utils.ts';
import { getContentUrl } from '#lib/utils/routing.ts';

interface Props {
	entry: CollectionEntry<'locations' | 'posts' | 'regions' | 'resources' | 'themes'>;
}

const { entry, ...props } = Astro.props;

const getResolveResourceLinks = await getResolveResourceLinksFunction();

const links = getResolveResourceLinks(entry);

const t = getTranslations();
---

{
	links && links.length > 0 ? (
		<ContentSection data-pagefind-ignore data-nosnippet {...props}>
			<Fragment slot="section-title">{t('content.section.links')}</Fragment>
			<ListColumn class="font-serif text-xs sm:text-sm">
				{links.map((link) => {
					const titleMultilingual = getPrimaryMultilingualContent(link, 'title');

					return (
						<ListColumnItem>
							{'showPage' in link && link.showPage ? (
								<>
									<DividedItem>
										<Link href={link.url}>{link.title}</Link>
										{titleMultilingual ? (
											<TextMultilingual content={titleMultilingual} parenthesis={true} />
										) : undefined}
									</DividedItem>
									<DividedItem>
										<Link class="italic" href={getContentUrl('resources', link.id)}>
											{t('collection.resources.showPage.label')}
										</Link>
									</DividedItem>
								</>
							) : (
								<>
									<Link href={link.url}>{link.title}</Link>
									{titleMultilingual ? (
										<TextMultilingual content={titleMultilingual} parenthesis={true} />
									) : undefined}
								</>
							)}
						</ListColumnItem>
					);
				})}
			</ListColumn>
		</ContentSection>
	) : undefined
}
