---
import type { CollectionEntry } from 'astro:content';

import { LocationStatusEnum } from '@spectralcodex/map-types';
import * as R from 'remeda';

import type { LanguageCode } from '#lib/i18n/i18n-types.ts';

import ContentSection from '#components/content/content-section.astro';
import FormatMarkdown from '#components/format/format-markdown.astro';
import AlertBox from '#components/parts/alert-box.astro';
import { getTranslations } from '#lib/i18n/i18n-translations.ts';

interface Props {
	entry: CollectionEntry<'locations'>;
	langCode?: Extract<LanguageCode, 'zh' | 'zh-CN' | 'ja' | 'ko'> | undefined;
}

const { entry, langCode, ...props } = Astro.props;

const showDangerNotice = entry.data.safety
	? entry.data.safety <= 2
	: R.isIncludedIn(entry.data.status, [
			LocationStatusEnum.Abandoned,
			LocationStatusEnum.Idle,
			LocationStatusEnum.Remnants,
		]);

const showDemolishedNotice = entry.data.status === LocationStatusEnum.Demolished;

const showChinese = langCode?.startsWith('zh');

const t = getTranslations();
---

{
	showDangerNotice || showDemolishedNotice ? (
		<ContentSection class="flex flex-col gap-2" {...props} data-pagefind-ignore>
			{showDemolishedNotice ? (
				<AlertBox status="warning">
					<FormatMarkdown>{t('notice.demolished')}</FormatMarkdown>
					{showChinese ? (
						<FormatMarkdown>{t('notice.demolished', langCode)}</FormatMarkdown>
					) : undefined}
				</AlertBox>
			) : undefined}
			{showDangerNotice && !showDemolishedNotice ? (
				<AlertBox status="warning">
					<FormatMarkdown>{t('notice.danger')}</FormatMarkdown>
					{showChinese ? (
						<FormatMarkdown>{t('notice.danger', langCode)}</FormatMarkdown>
					) : undefined}
				</AlertBox>
			) : undefined}
			{entry.data.entryQuality <= 1 ? (
				<AlertBox status="warning">
					<FormatMarkdown>{t('notice.quality')}</FormatMarkdown>
					{showChinese ? (
						<FormatMarkdown>{t('notice.quality', langCode)}</FormatMarkdown>
					) : undefined}
				</AlertBox>
			) : undefined}
		</ContentSection>
	) : undefined
}
