---
import type { ModeGeneralType } from '#lib/main/main-types.ts';

import { ModeTypeEnum } from '#lib/main/main-types.ts';

interface Props {
	defaultMode?: ModeGeneralType | undefined;
}

const { defaultMode = ModeTypeEnum.Auto } = Astro.props;
---

<script is:inline data-default-mode={defaultMode}>
	(function () {
		let stored;

		try {
			stored = localStorage.getItem('scx-mode');
		} catch {
			// localStorage unavailable
		}

		let mode =
			stored === 'auto' || stored === 'light' || stored === 'dark'
				? stored
				: (document.currentScript.dataset.defaultMode ?? 'auto');

		if (mode === 'auto') {
			mode = matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
		}

		document.documentElement.dataset.mode = mode;
		document.documentElement.style.colorScheme = mode;
	})();
</script>

<script>
	import '#lib/components/mode-manager.ts';
</script>

<mode-manager default-mode={defaultMode}></mode-manager>
