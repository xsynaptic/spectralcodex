---
import { getTranslations } from '#lib/i18n/i18n-translations.ts';

interface Props {
	carouselId: string;
}

const { carouselId } = Astro.props;

const t = getTranslations();
---

<button
	type="button"
	class:list={[
		'pointer-events-auto absolute top-1/2 z-30 hidden h-12 w-12 -translate-y-1/2 cursor-pointer items-center justify-center rounded-full opacity-0 grayscale transition-all duration-200 group-hover:opacity-100 active:scale-90 lg:flex',
		'bg-white/25 text-white/75 hover:bg-white/50 hover:text-white/80',
		'left-2',
	]}
	data-carousel-nav="prev"
	data-carousel-target={carouselId}
	aria-label={t('carousel.nav.previous')}
>
	<svg
		xmlns="http://www.w3.org/2000/svg"
		width="24"
		height="24"
		viewBox="0 0 24 24"
		class="h-8 w-8 -translate-x-0.5"
		aria-hidden="true"
	>
		<path
			fill="none"
			stroke="currentColor"
			stroke-linecap="round"
			stroke-linejoin="round"
			stroke-width="3"
			d="m15 18l-6-6l6-6"></path>
	</svg>
</button>
<button
	type="button"
	class:list={[
		'pointer-events-auto absolute top-1/2 z-30 hidden h-12 w-12 -translate-y-1/2 cursor-pointer items-center justify-center rounded-full opacity-0 grayscale transition-all duration-200 group-hover:opacity-100 active:scale-90 lg:flex',
		'bg-white/25 text-white/75 hover:bg-white/50 hover:text-white/80',
		'right-2',
	]}
	data-carousel-nav="next"
	data-carousel-target={carouselId}
	aria-label={t('carousel.nav.next')}
>
	<svg
		xmlns="http://www.w3.org/2000/svg"
		width="24"
		height="24"
		viewBox="0 0 24 24"
		class="h-8 w-8 translate-x-0.5"
		aria-hidden="true"
	>
		<path
			fill="none"
			stroke="currentColor"
			stroke-linecap="round"
			stroke-linejoin="round"
			stroke-width="3"
			d="m9 18l6-6l-6-6"></path>
	</svg>
</button>

<script>
	function initialize() {
		const buttons = document.querySelectorAll<HTMLButtonElement>('[data-carousel-nav]');

		for (const button of buttons) {
			button.addEventListener('click', () => {
				const targetId = button.dataset.carouselTarget;
				const direction = button.dataset.carouselNav;

				const container = document.querySelector<HTMLElement>(
					`[data-carousel-id="${targetId}"] .carousel-container`
				);

				if (!container) return;

				const itemWidth =
					container.querySelector('.carousel-item')?.clientWidth ?? container.clientWidth;
				const maxScroll = container.scrollWidth - container.clientWidth;
				const atStart = container.scrollLeft < itemWidth / 2;
				const atEnd = container.scrollLeft > maxScroll - itemWidth / 2;

				if (direction === 'prev' && atStart) {
					container.scrollTo({ left: maxScroll, behavior: 'smooth' }); // Wrap to end
				} else if (direction === 'next' && atEnd) {
					container.scrollTo({ left: 0, behavior: 'smooth' }); // Wrap to start
				} else {
					container.scrollBy({
						left: direction === 'next' ? itemWidth : -itemWidth,
						behavior: 'smooth',
					});
				}
			});
		}
	}

	initialize();

	document.addEventListener('astro:after-swap', () => {
		initialize();
	});
</script>
