---
import type { HTMLTag, Polymorphic } from 'astro/types';

import type { ImagePlaceholderProps } from '#lib/image/image-types.ts';

import { getImagePlaceholderFunction } from '#lib/image/image-placeholders.ts';

/**
 * A standardized image placeholder component with a fallback image when no placeholder is passed
 */
type Props<Tag extends HTMLTag = HTMLTag> = Polymorphic<{
	as: Tag;
	class?: string | undefined;
	placeholderProps?: ImagePlaceholderProps | undefined;
}>;

const { as: Tag = 'div', class: className, placeholderProps, ...props } = Astro.props;

const getImagePlaceholder = await getImagePlaceholderFunction();

const placeholder = placeholderProps ? await getImagePlaceholder(placeholderProps) : undefined;
---

<Tag
	class:list={[
		placeholder ? 'bg-primary-200 bg-cover bg-center dark:bg-primary-700' : 'bg-fallback',
		className,
	]}
	style={placeholder
		? `background-image: url(${placeholder}); image-rendering: pixelated;`
		: undefined}
	{...props}
>
	<slot />
</Tag>
