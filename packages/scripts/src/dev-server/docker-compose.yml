# Development image server for spectralcodex
# Started automatically by `pnpm dev`

services:
  image-cache:
    image: nginx:1.27-alpine
    container_name: dev-image-cache
    ports:
      - "3100:80"
    volumes:
      - ${DEPLOY_IMAGE_SERVER_PATH}/nginx.conf.template:/etc/nginx/templates/default.conf.template:ro
    environment:
      - IPX_SERVER_SECRET=${IPX_SERVER_SECRET:-dev-secret-do-not-use-in-production}
    depends_on:
      - image-server

  image-server:
    build: ${DEPLOY_IMAGE_SERVER_PATH}
    container_name: dev-image-server
    volumes:
      - ${CONTENT_MEDIA_PATH}:/media:ro
    environment:
      - NODE_ENV=development
      - PORT=3000
      - IPX_FS_DIR=/media
      - IPX_FS_MAX_AGE=0
